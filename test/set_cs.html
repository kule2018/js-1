<!DOCTYPE HTML>
<html>
<head>
    <title>test</title>
    <style type="text/css">
        *
        {
            padding: 0;
            margin: 0;
        }

        #div
        {
        }
    </style>
</head>

<body>

    <div id="div">
    </div>
    <script type="text/javascript">

        function log(o) {
            try {
                console.log(o);
            }
            catch (e) {
                alert(o);
            }
        }

        function addEvent(el, type, fn) {
            if (el.addEventListener) {
                el.addEventListener(type, fn, false);
            }
            else {
                el.attachEvent('on' + type, fn);
            }
        }

        function Set() {
            this.values = {};
            this.n = 0;
            this.add.apply(this, arguments);
        }

        Set.prototype.add = function () {
            for (var i = 0, len = arguments.length; i < len; i++) {
                var val = arguments[i],
                    str = Set.v2s(val);

                if (!this.values.hasOwnProperty(str)) {
                    this.values[str] = val;
                    this.n++;
                }
            }
            return this;
        };

        Set.prototype.remove = function () {
            for (var i = 0, len = arguments.length; i < len; i++) {
                var str = Set.v2s(arguments[i]);
                if (this.values.hasOwnProperty(str)) {
                    delete this.values[str];
                    this.n--;
                }
            }
            return this;
        };

        Set.prototype.contains = function (val) {
            return this.values.hasOwnProperty(Set.v2s(val));
        };

        Set.prototype.size = function () {
            return this.n;
        };

        Set.prototype.foreach = function (f, context) {
            for (var s in this.values) {
                this.values.hasOwnProperty(s) && f.call(context, this.values[s]);
            }
        };

        Set.v2s = (function () {
            function objectId(o) {
                var prop = '|**objectId**|';
                if (!o.hasOwnProperty(prop)) {
                    o[prop] = Set.v2s.next++;
                }
                return o[prop]
            }

            return function (val) {
                switch (val) {
                    case undefined: {
                        return 'u';
                        break;
                    }
                    case null: {
                        return 'n';
                        break;
                    }
                    case true: {
                        return 't';
                        break;
                    }
                    case false: {
                        return 'f';
                        break;
                    }
                    default: {
                        switch (typeof val) {
                            case 'number': {
                                return '#' + val;
                            }
                            case 'string': {
                                return '"' + val;
                            }
                            default: {
                                return '@' + objectId(val);
                            }
                        }
                    }
                }
            };
        })();
        Set.v2s.next = 100;

        var setInst = new Set(1, "3", { 1: 1 });

    </script>
</body>
</html>
